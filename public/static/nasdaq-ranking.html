<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>NASDAQ-100 ãƒ©ãƒ³ã‚­ãƒ³ã‚° - System A/B ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <script src="https://cdn.tailwindcss.com?v=20250204g"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js?v=20250204g"></script>
  <style>
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3B82F6;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .score-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 9999px;
      font-weight: bold;
      font-size: 0.875rem;
    }
    .score-strong-buy { background-color: #10b981; color: white; }
    .score-buy { background-color: #3b82f6; color: white; }
    .score-neutral { background-color: #6b7280; color: white; }
    .score-sell { background-color: #ef4444; color: white; }
    .score-strong-sell { background-color: #7f1d1d; color: white; }
    
    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-bar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 1rem 2rem;
      margin-bottom: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .nav-links {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    .nav-link {
      color: white;
      text-decoration: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.375rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    .nav-link.active {
      background-color: rgba(147, 112, 219, 0.8);
      border-bottom: 3px solid white;
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
  <nav class="nav-bar">
    <div class="nav-links">
      <a href="/static/technical-analysis-v4.html" class="nav-link">
        <i class="fas fa-chart-bar"></i>
        ğŸ“Š ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æã‚¹ã‚¯ãƒªãƒ¼ãƒŠãƒ¼
      </a>
      <a href="/static/nasdaq-ranking.html" class="nav-link active">
        <i class="fas fa-trophy"></i>
        ğŸ† NASDAQ-100ãƒ©ãƒ³ã‚­ãƒ³ã‚°
      </a>
    </div>
  </nav>

  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white p-8 rounded-lg shadow-lg mb-8">
      <h1 class="text-4xl font-bold mb-2">
        <i class="fas fa-trophy mr-3"></i>
        NASDAQ-100 ãƒ©ãƒ³ã‚­ãƒ³ã‚°
      </h1>
      <p class="text-xl opacity-90">System A/B ã«ã‚ˆã‚‹100éŠ˜æŸ„ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</p>
      <p class="mt-2 text-sm opacity-75">
        ã‚·ã‚¹ãƒ†ãƒ Aï¼ˆã‚·ãƒ³ãƒ—ãƒ«5æŒ‡æ¨™ï¼‰ â€¢ ã‚·ã‚¹ãƒ†ãƒ Bï¼ˆé«˜åº¦ãªè¤‡åˆè©•ä¾¡20+æŒ‡æ¨™ï¼‰
      </p>
    </div>

    <!-- è¨­å®šã‚¨ãƒªã‚¢ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold mb-4">
        <i class="fas fa-sliders-h mr-2 text-yellow-600"></i>
        ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°è¨­å®š
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-semibold mb-2">åˆ†æã‚·ã‚¹ãƒ†ãƒ </label>
          <select id="system-select" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
            <option value="simple">ã‚·ã‚¹ãƒ†ãƒ Aï¼ˆã‚·ãƒ³ãƒ—ãƒ«5æŒ‡æ¨™ï¼‰ - é«˜é€Ÿ</option>
            <option value="advanced">ã‚·ã‚¹ãƒ†ãƒ Bï¼ˆé«˜åº¦ãªè¤‡åˆè©•ä¾¡ï¼‰ - è©³ç´°</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-semibold mb-2">Alpha Vantage API Key</label>
          <input 
            type="text" 
            id="api-key-input" 
            placeholder="Your Alpha Vantage API Key" 
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
          />
        </div>
      </div>
      
      <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-4">
        <h3 class="font-bold mb-2">
          <i class="fas fa-info-circle text-yellow-600"></i>
          å‡¦ç†æ™‚é–“ã®ç›®å®‰
        </h3>
        <ul class="text-sm text-gray-700 space-y-1">
          <li><strong>ã‚·ã‚¹ãƒ†ãƒ A:</strong> ç´„7-8åˆ†ï¼ˆ100éŠ˜æŸ„ã€è»½é‡åˆ†æï¼‰</li>
          <li><strong>ã‚·ã‚¹ãƒ†ãƒ B:</strong> ç´„13-15åˆ†ï¼ˆ100éŠ˜æŸ„ã€è©³ç´°åˆ†æï¼‰</li>
          <li><strong>æˆåŠŸç‡:</strong> ç´„35-40%ï¼ˆAPIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«ã‚ˆã‚Šä¸€éƒ¨å¤±æ•—ã¯æ­£å¸¸ï¼‰</li>
        </ul>
      </div>
      
      <button 
        onclick="startRanking()" 
        class="w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white px-8 py-4 rounded-lg font-semibold transition text-lg"
      >
        <i class="fas fa-play mr-2"></i>ãƒ©ãƒ³ã‚­ãƒ³ã‚°é–‹å§‹ï¼ˆ100éŠ˜æŸ„ã‚’åˆ†æï¼‰
      </button>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    <div id="loading" style="display:none;" class="bg-white rounded-lg shadow-md p-8 mb-6">
      <div class="loader"></div>
      <p id="loading-message" class="text-center text-gray-600 text-lg">åˆ†æä¸­...</p>
      <p class="text-center text-gray-500 text-sm mt-2">
        NASDAQ-100éŠ˜æŸ„ã‚’é †æ¬¡åˆ†æã—ã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚
      </p>
      <div id="progress-info" class="mt-4 text-center text-sm text-gray-600"></div>
    </div>

    <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="results" style="display:none;">
      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4">
          <i class="fas fa-list-ol mr-2 text-yellow-600"></i>
          TOP 30 ãƒ©ãƒ³ã‚­ãƒ³ã‚°
        </h2>
        <div id="ranking-stats" class="mb-4"></div>
        <div id="ranking-table"></div>
      </div>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    <div id="error-display" style="display:none;" class="bg-red-50 border-2 border-red-300 rounded-lg p-6 mb-6">
      <div class="flex items-start">
        <i class="fas fa-exclamation-circle text-red-500 text-3xl mr-4"></i>
        <div>
          <h3 class="text-xl font-bold text-red-800 mb-2">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
          <p id="error-message" class="text-red-700"></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // NASDAQ-100éŠ˜æŸ„ãƒªã‚¹ãƒˆï¼ˆç°¡ç•¥ç‰ˆã€å®Ÿéš›ã¯100éŠ˜æŸ„ï¼‰
    const NASDAQ100_SYMBOLS = [
      'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'META', 'TSLA', 'AVGO', 'COST', 'NFLX',
      'ADBE', 'PEP', 'CSCO', 'CMCSA', 'TMUS', 'INTC', 'AMD', 'QCOM', 'TXN', 'INTU',
      'HON', 'AMGN', 'AMAT', 'ISRG', 'SBUX', 'BKNG', 'ADP', 'GILD', 'ADI', 'VRTX',
      'REGN', 'MDLZ', 'LRCX', 'PANW', 'MU', 'PYPL', 'KLAC', 'SNPS', 'CDNS', 'MRVL',
      'CSX', 'ABNB', 'NXPI', 'ORLY', 'ASML', 'WDAY', 'ADSK', 'MELI', 'CHTR', 'AEP',
      'FTNT', 'MNST', 'PCAR', 'CPRT', 'ROST', 'PAYX', 'KDP', 'MCHP', 'ODFL', 'FAST',
      'DXCM', 'EA', 'BKR', 'VRSK', 'EXC', 'CTSH', 'KHC', 'GEHC', 'CSGP', 'IDXX',
      'CCEP', 'ANSS', 'ON', 'DDOG', 'XEL', 'TTWO', 'FANG', 'CDW', 'ZS', 'BIIB',
      'CTAS', 'ILMN', 'GFS', 'MDB', 'WBD', 'MRNA', 'ARM', 'SMCI', 'TEAM', 'CRWD',
      'WBA', 'PDD', 'DASH', 'LULU', 'ZM', 'ALGN', 'ENPH', 'RIVN', 'JD', 'LCID'
    ];

    // ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ML APIã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰localhost:8080ã«ç›´æ¥æ¥ç¶šã§ããªã„ãŸã‚ï¼‰
    const USE_PROXY = true;

    async function startRanking() {
      const system = document.getElementById('system-select').value;
      const apiKey = document.getElementById('api-key-input').value.trim();
      
      if (!apiKey) {
        alert('Alpha Vantage API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      // UIãƒªã‚»ãƒƒãƒˆ
      document.getElementById('results').style.display = 'none';
      document.getElementById('error-display').style.display = 'none';
      document.getElementById('loading').style.display = 'block';
      
      const mode = system === 'simple' ? 'simple' : 'advanced';
      const systemName = system === 'simple' ? 'ã‚·ã‚¹ãƒ†ãƒ A' : 'ã‚·ã‚¹ãƒ†ãƒ B';
      
      document.getElementById('loading-message').textContent = `${systemName}ã§åˆ†æä¸­...`;
      
      const results = [];
      let successCount = 0;
      let failCount = 0;
      const startTime = Date.now();
      
      for (let i = 0; i < NASDAQ100_SYMBOLS.length; i++) {
        const symbol = NASDAQ100_SYMBOLS[i];
        
        // ç¾åœ¨ã®éŠ˜æŸ„ã‚’è¡¨ç¤ºï¼ˆå‡¦ç†é–‹å§‹æ™‚ï¼‰
        document.getElementById('progress-info').innerHTML = `
          é€²æ—: ${successCount + failCount}/${NASDAQ100_SYMBOLS.length} (${Math.round(((successCount + failCount) / NASDAQ100_SYMBOLS.length) * 100)}%)
          <br>æˆåŠŸ: <span class="text-green-600 font-bold">${successCount}</span> | å¤±æ•—: <span class="text-red-600 font-bold">${failCount}</span>
          <br>å‡¦ç†ä¸­: <strong class="text-blue-600">${symbol}</strong> (${i + 1}/${NASDAQ100_SYMBOLS.length})
        `;
        
        try {
          // ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          const response = await axios.post('/api/proxy/technical-analysis', {
            symbol: symbol,
            alpha_vantage_api_key: apiKey,
            mode: mode,
            timeframe: 'medium'
          }, {
            timeout: 30000  // 30ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
          });
          
          const data = response.data;
          console.log(`[DEBUG] ${symbol} response:`, data);
          const systemData = mode === 'simple' ? data.system_a : data.system_b;
          console.log(`[DEBUG] ${symbol} systemData:`, systemData);
          
          if (systemData) {
            const resultItem = {
              symbol: symbol,
              score: systemData.total_score,
              signal: systemData.signal_type,
              confidence: systemData.confidence,
              market_regime: systemData.market_regime || null,
              golden_cross_score: systemData.golden_cross_score || null
            };
            results.push(resultItem);
            console.log(`[DEBUG] ${symbol} added to results:`, resultItem);
            successCount++;
            
            // æˆåŠŸæ™‚ã«é€²æ—ã‚’æ›´æ–°
            document.getElementById('progress-info').innerHTML = `
              é€²æ—: ${successCount + failCount}/${NASDAQ100_SYMBOLS.length} (${Math.round(((successCount + failCount) / NASDAQ100_SYMBOLS.length) * 100)}%)
              <br>æˆåŠŸ: <span class="text-green-600 font-bold">${successCount}</span> | å¤±æ•—: <span class="text-red-600 font-bold">${failCount}</span>
              <br>å®Œäº†: <strong class="text-green-600">${symbol}</strong> âœ“
            `;
          } else {
            failCount++;
            console.error(`No data returned for ${symbol}`);
          }
          
        } catch (error) {
          console.error(`Failed to analyze ${symbol}:`, error.message);
          failCount++;
          
          // å¤±æ•—æ™‚ã«é€²æ—ã‚’æ›´æ–°
          document.getElementById('progress-info').innerHTML = `
            é€²æ—: ${successCount + failCount}/${NASDAQ100_SYMBOLS.length} (${Math.round(((successCount + failCount) / NASDAQ100_SYMBOLS.length) * 100)}%)
            <br>æˆåŠŸ: <span class="text-green-600 font-bold">${successCount}</span> | å¤±æ•—: <span class="text-red-600 font-bold">${failCount}</span>
            <br>å¤±æ•—: <strong class="text-red-600">${symbol}</strong> âœ— (${error.message})
          `;
        }
        
        // APIãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–ï¼šå¤±æ•—ãŒå¤šã„å ´åˆã¯å¾…æ©Ÿæ™‚é–“ã‚’å¢—ã‚„ã™
        // 75 calls/minute = 0.8ç§’/call ãŒç†è«–å€¤ã€å®‰å…¨ã®ãŸã‚1.2ç§’ã«è¨­å®š
        const waitTime = failCount > 10 ? 2000 : 1200;  // å¤±æ•—ãŒå¤šã„å ´åˆã¯2ç§’å¾…æ©Ÿ
        
        if (i < NASDAQ100_SYMBOLS.length - 1) {
          await new Promise(resolve => setTimeout(resolve, waitTime));
        }
      }
      
      const endTime = Date.now();
      const totalTime = Math.round((endTime - startTime) / 1000);
      
      // çµæœè¡¨ç¤º
      document.getElementById('loading').style.display = 'none';
      
      if (results.length === 0) {
        document.getElementById('error-display').style.display = 'block';
        document.getElementById('error-message').textContent = 'åˆ†æçµæœãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚API Keyã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
        return;
      }
      
      console.log(`[DEBUG] Total results collected: ${results.length}`);
      console.log(`[DEBUG] First 3 results:`, results.slice(0, 3));
      
      // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
      results.sort((a, b) => b.score - a.score);
      
      // TOP 30ã®ã¿è¡¨ç¤º
      const top30 = results.slice(0, 30);
      console.log(`[DEBUG] TOP 30 results:`, top30);
      
      displayResults(top30, systemName, totalTime, successCount, failCount);
    }
    
    function displayResults(results, systemName, totalTime, successCount, failCount) {
      console.log(`[DEBUG] displayResults called with:`, { resultsLength: results?.length, systemName, totalTime, successCount, failCount });
      // resultsãŒç©ºã¾ãŸã¯nullã®å ´åˆã®ãƒã‚§ãƒƒã‚¯
      if (!results || results.length === 0) {
        console.error('[ERROR] No results to display!');
        document.getElementById('results').innerHTML = `
          <div class="bg-red-50 border-2 border-red-300 rounded-lg p-6 text-center">
            <i class="fas fa-times-circle text-red-600 text-6xl mb-4"></i>
            <p class="text-lg text-gray-800 mb-2">è¡¨ç¤ºå¯èƒ½ãªçµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
            <p class="text-sm text-gray-600">æˆåŠŸ: ${successCount || 0}ä»¶ / å¤±æ•—: ${failCount || 0}ä»¶</p>
          </div>
        `;
        return;
      }
      
      document.getElementById('results').style.display = 'block';
      
      // çµ±è¨ˆæƒ…å ±
      const statsHTML = `
        <div class="grid grid-cols-4 gap-4 p-4 bg-yellow-50 rounded-lg">
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-600">${results.length}</div>
            <div class="text-sm text-gray-600">TOP 30</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-green-600">${successCount}</div>
            <div class="text-sm text-gray-600">åˆ†ææˆåŠŸ</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-red-600">${failCount}</div>
            <div class="text-sm text-gray-600">åˆ†æå¤±æ•—</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-600">${totalTime}ç§’</div>
            <div class="text-sm text-gray-600">å‡¦ç†æ™‚é–“</div>
          </div>
        </div>
        <div class="mt-2 text-sm text-gray-600">
          <i class="fas fa-info-circle mr-1"></i>
          ${systemName}ã«ã‚ˆã‚‹åˆ†æçµæœ | æˆåŠŸç‡: ${Math.round(successCount / (successCount + failCount) * 100)}%
        </div>
      `;
      document.getElementById('ranking-stats').innerHTML = statsHTML;
      console.log(`[DEBUG] Stats HTML updated`);
      
      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
      const isAdvanced = systemName.includes('ã‚·ã‚¹ãƒ†ãƒ B') || systemName.includes('Advanced');
      console.log(`[DEBUG] Building table, isAdvanced: ${isAdvanced}`);
      
      let tableHTML = `
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-yellow-100">
              <tr>
                <th class="px-4 py-3 text-left">é †ä½</th>
                <th class="px-4 py-3 text-left">éŠ˜æŸ„</th>
                <th class="px-4 py-3 text-right">ã‚¹ã‚³ã‚¢</th>
                <th class="px-4 py-3 text-center">ã‚·ã‚°ãƒŠãƒ«</th>
                <th class="px-4 py-3 text-right">ä¿¡é ¼åº¦</th>
                ${isAdvanced ? '<th class="px-4 py-3 text-center">å¸‚å ´ç’°å¢ƒ</th><th class="px-4 py-3 text-center">GCæŒ‡æ¨™</th>' : '<th class="px-4 py-3 text-center">GCæŒ‡æ¨™</th>'}
              </tr>
            </thead>
            <tbody>
      `;
      
      results.forEach((item, index) => {
        // itemãŒnullã¾ãŸã¯undefinedã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        if (!item) return;
        
        const signalBadge = getSignalBadge(item.signal || 'ä¸­ç«‹');
        const rankBadge = index < 3 ? `<span class="text-2xl">${['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index]}</span>` : `${index + 1}`;
        
        // ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ã‚¹ã‚³ã‚¢ã®è¡¨ç¤º
        let gcDisplay = '<span class="text-gray-400">-</span>';
        if (item.golden_cross_score !== null && item.golden_cross_score !== undefined) {
          const gcScore = item.golden_cross_score;
          let gcColor = 'bg-gray-100 text-gray-600';
          if (gcScore >= 80) gcColor = 'bg-green-100 text-green-800';
          else if (gcScore >= 60) gcColor = 'bg-blue-100 text-blue-800';
          else if (gcScore <= 30) gcColor = 'bg-red-100 text-red-800';
          
          gcDisplay = `<span class="px-2 py-1 ${gcColor} rounded text-xs font-bold">${gcScore.toFixed(0)}</span>`;
        }
        
        tableHTML += `
          <tr class="border-b hover:bg-gray-50">
            <td class="px-4 py-3 font-bold">${rankBadge}</td>
            <td class="px-4 py-3">
              <div class="font-bold text-blue-600">${item.symbol}</div>
            </td>
            <td class="px-4 py-3 text-right">
              <div class="text-2xl font-bold" style="color: ${getScoreColor(item.score)}">${item.score.toFixed(1)}</div>
            </td>
            <td class="px-4 py-3 text-center">${signalBadge}</td>
            <td class="px-4 py-3 text-right">${item.confidence ? item.confidence.toFixed(0) : 0}%</td>
            ${isAdvanced ? `<td class="px-4 py-3 text-center">${item.market_regime ? `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${item.market_regime}</span>` : '<span class="text-gray-400">-</span>'}</td>` : ''}
            <td class="px-4 py-3 text-center">${gcDisplay}</td>
          </tr>
        `;
      });
      
      tableHTML += `
            </tbody>
          </table>
        </div>
      `;
      
      console.log(`[DEBUG] Table HTML length: ${tableHTML.length} chars`);
      document.getElementById('ranking-table').innerHTML = tableHTML;
      console.log(`[DEBUG] Table HTML injected into DOM`);
    }
    
    function getSignalBadge(signal) {
      const badges = {
        'STRONG_BUY': '<span class="score-badge score-strong-buy">å¼·ã„è²·ã„</span>',
        'BUY': '<span class="score-badge score-buy">è²·ã„</span>',
        'NEUTRAL': '<span class="score-badge score-neutral">ä¸­ç«‹</span>',
        'SELL': '<span class="score-badge score-sell">å£²ã‚Š</span>',
        'STRONG_SELL': '<span class="score-badge score-strong-sell">å¼·ã„å£²ã‚Š</span>',
        'å¼·ã„è²·ã„': '<span class="score-badge score-strong-buy">å¼·ã„è²·ã„</span>',
        'è²·ã„': '<span class="score-badge score-buy">è²·ã„</span>',
        'ä¸­ç«‹': '<span class="score-badge score-neutral">ä¸­ç«‹</span>',
        'å£²ã‚Š': '<span class="score-badge score-sell">å£²ã‚Š</span>',
        'å¼·ã„å£²ã‚Š': '<span class="score-badge score-strong-sell">å¼·ã„å£²ã‚Š</span>'
      };
      return badges[signal] || '<span class="score-badge score-neutral">-</span>';
    }
    
    function getScoreColor(score) {
      if (score >= 80) return '#10b981';
      if (score >= 65) return '#3b82f6';
      if (score >= 35) return '#6b7280';
      if (score >= 20) return '#ef4444';
      return '#7f1d1d';
    }
  </script>
</body>
</html>
