# æ ªä¾¡MLäºˆæ¸¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒŠãƒ¬ãƒƒã‚¸

**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥æ™‚**: 2025-11-04  
**ç¨¼åƒç¢ºèªæ¸ˆã¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³**

---

## ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URL

1. **webapp (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)**
   - URL: https://page.gensparksite.com/project_backups/webapp_working_state_2025-11-04.tar.gz
   - ã‚µã‚¤ã‚º: 17.4 MB
   - èª¬æ˜: Next.jsä¸ä½¿ç”¨ã€è»½é‡Node.jsã‚µãƒ¼ãƒãƒ¼ + é™çš„HTML

2. **ml-api (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)**
   - URL: https://page.gensparksite.com/project_backups/ml-api_working_state_2025-11-04.tar.gz
   - ã‚µã‚¤ã‚º: 0.78 MB
   - èª¬æ˜: FastAPI + LightGBM + Alpha Vantage APIçµ±åˆ

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ãƒ¦ãƒ¼ã‚¶ãƒ¼                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Port 3000) - simple-server.cjs              â”‚
â”‚  - NASDAQ-100 ãƒ©ãƒ³ã‚­ãƒ³ã‚° (nasdaq-ranking.html)               â”‚
â”‚  - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æ v4 (technical-analysis-v4.html)            â”‚
â”‚  - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒŠãƒ¼ (technical-scanner.html)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Port 8001) - FastAPI (main.py)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚·ã‚¹ãƒ†ãƒ A: ã‚·ãƒ³ãƒ—ãƒ«5æŒ‡æ¨™è©•ä¾¡                           â”‚  â”‚
â”‚  â”‚ (technical_scoring.py)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚·ã‚¹ãƒ†ãƒ B: é«˜åº¦çŸ­æœŸãƒˆãƒ¬ãƒ¼ãƒ‰åˆ†æ                        â”‚  â”‚
â”‚  â”‚ (technical_scoring_advanced.py)                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚·ã‚¹ãƒ†ãƒ C: MLäºˆæ¸¬ (LightGBM 107ç‰¹å¾´é‡)                 â”‚  â”‚
â”‚  â”‚ (technical_ml_model.py, feature_engineering.py)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (1æ™‚é–“TTL)                      â”‚  â”‚
â”‚  â”‚ (cache_manager.py)                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–éƒ¨API - Alpha Vantage                                     â”‚
â”‚  (alpha_vantage_client.py)                                   â”‚
â”‚  - Premium Key: 75 calls/minute                              â”‚
â”‚  - 21ç¨®é¡ã®ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™å–å¾—                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“„ ãƒšãƒ¼ã‚¸åˆ¥è©³ç´°èª¬æ˜

---

## 1ï¸âƒ£ NASDAQ-100 ãƒ©ãƒ³ã‚­ãƒ³ã‚° (`nasdaq-ranking.html`)

### ğŸ¯ ç›®çš„
NASDAQ-100æ§‹æˆéŠ˜æŸ„å…¨100ç¤¾ã‚’ãƒãƒƒãƒå‡¦ç†ã§åˆ†æã—ã€ã‚·ã‚¹ãƒ†ãƒ A/Bã®ã‚¹ã‚³ã‚¢ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º

### ğŸ“Š å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰
   â†“
2. ã€ŒNASDAQ-100éŠ˜æŸ„ã‚’ä¸€æ‹¬åˆ†æã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
3. NASDAQ-100ã‚·ãƒ³ãƒœãƒ«ãƒªã‚¹ãƒˆå–å¾— (100éŠ˜æŸ„)
   â†“
4. å„éŠ˜æŸ„ã«å¯¾ã—ã¦ä¸¦åˆ—APIå‘¼ã³å‡ºã— (Promise.all)
   - /api/proxy/technical-analysis (ã‚·ã‚¹ãƒ†ãƒ A/B)
   â†“
5. çµæœã‚’é›†ç´„
   â†“
6. ã‚·ã‚¹ãƒ†ãƒ Aã‚¹ã‚³ã‚¢é †ã§ã‚½ãƒ¼ãƒˆ
   â†“
7. ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º (DataTables.jsä½¿ç”¨)
   - ã‚·ã‚¹ãƒ†ãƒ Aã‚¹ã‚³ã‚¢
   - ã‚·ã‚¹ãƒ†ãƒ Bã‚¹ã‚³ã‚¢
   - ã‚·ã‚°ãƒŠãƒ« (å¼·ã„è²·ã„/è²·ã„/ä¸­ç«‹/å£²ã‚Š/å¼·ã„å£²ã‚Š)
   - GC(ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹)æŒ‡æ¨™
```

### ğŸ”‘ ä¸»è¦æ©Ÿèƒ½

#### NASDAQ-100ã‚·ãƒ³ãƒœãƒ«ãƒªã‚¹ãƒˆ (100éŠ˜æŸ„)
```javascript
const nasdaq100Symbols = [
  'AAPL', 'MSFT', 'GOOGL', 'GOOG', 'AMZN', 'NVDA', 'META', 'TSLA',
  // ... å…¨100éŠ˜æŸ„
]
```

#### ãƒãƒƒãƒåˆ†æå‡¦ç†
```javascript
async function analyzeAllStocks() {
  const promises = nasdaq100Symbols.map(async (symbol) => {
    const response = await axios.post('/api/proxy/technical-analysis', {
      symbol: symbol,
      alpha_vantage_api_key: apiKey
    })
    return {
      symbol: symbol,
      system_a_score: response.data.system_a.total_score,
      system_b_score: response.data.system_b.total_score,
      system_a_signal: response.data.system_a.signal,
      system_b_signal: response.data.system_b.signal,
      gc_score: response.data.system_b.golden_cross_score
    }
  })
  
  const results = await Promise.all(promises)
  displayResults(results)
}
```

#### DataTablesè¡¨ç¤º
```javascript
$('#rankingTable').DataTable({
  data: sortedResults,
  columns: [
    { data: 'rank' },
    { data: 'symbol' },
    { data: 'system_a_score' },
    { data: 'system_a_signal' },
    { data: 'system_b_score' },
    { data: 'gc_score' }
  ],
  order: [[2, 'desc']], // ã‚·ã‚¹ãƒ†ãƒ Aã‚¹ã‚³ã‚¢é™é †
  pageLength: 25
})
```

### âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

1. **Alpha Vantageã‚­ãƒ£ãƒƒã‚·ãƒ¥**
   - 1æ™‚é–“TTL
   - åŒä¸€éŠ˜æŸ„ã®å†åˆ†æã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«å¿œç­”

2. **ä¸¦åˆ—å‡¦ç†**
   - Promise.allã§å…¨éŠ˜æŸ„ã‚’ä¸¦åˆ—å‡¦ç†
   - 100éŠ˜æŸ„ã§ã‚‚æ•°åˆ†ã§å®Œäº†ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æ™‚ã¯æ•°ç§’ï¼‰

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–**
   - Alpha Vantage: 75 calls/minute (Premium)
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§å‘¼ã³å‡ºã—å›æ•°ã‚’å‰Šæ¸›

---

## 2ï¸âƒ£ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æ v4 (`technical-analysis-v4.html`)

### ğŸ¯ ç›®çš„
å€‹åˆ¥éŠ˜æŸ„ã®è©³ç´°åˆ†æï¼ˆã‚·ã‚¹ãƒ†ãƒ A/B/Cã®å…¨ã¦ï¼‰ã‚’å®Ÿè¡Œã—ã€ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º

### ğŸ“Š å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. éŠ˜æŸ„ã‚·ãƒ³ãƒœãƒ«å…¥åŠ› (ä¾‹: META)
   â†“
2. ã€Œåˆ†æå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
3. ã‚·ã‚¹ãƒ†ãƒ A/Båˆ†æ
   - /api/proxy/technical-analysis
   â†“
4. ã‚·ã‚¹ãƒ†ãƒ C (MLäºˆæ¸¬) åˆ†æ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
   - /api/proxy/technical-ml-predict
   â†“
5. çµæœè¡¨ç¤º
   - ã‚·ã‚¹ãƒ†ãƒ A: 5æŒ‡æ¨™è©•ä¾¡ + ç·åˆã‚¹ã‚³ã‚¢
   - ã‚·ã‚¹ãƒ†ãƒ B: çŸ­æœŸãƒˆãƒ¬ãƒ¼ãƒ‰è©•ä¾¡ + GCã‚¹ã‚³ã‚¢
   - ã‚·ã‚¹ãƒ†ãƒ C: æœªæ¥7æ—¥äºˆæ¸¬ãƒãƒ£ãƒ¼ãƒˆ + ãƒãƒƒã‚¯ãƒ•ã‚£ãƒƒãƒˆæ¤œè¨¼ãƒãƒ£ãƒ¼ãƒˆ
```

### ğŸ”‘ ä¸»è¦æ©Ÿèƒ½

#### ã‚·ã‚¹ãƒ†ãƒ Aè¡¨ç¤º
```javascript
function displaySystemA(data) {
  // ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ã€RSIã€MACDã€ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ã€å‡ºæ¥é«˜
  // å„æŒ‡æ¨™ã®ã‚¹ã‚³ã‚¢ã¨ç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤º
  // ã‚·ã‚°ãƒŠãƒ«: å¼·ã„è²·ã„/è²·ã„/ä¸­ç«‹/å£²ã‚Š/å¼·ã„å£²ã‚Š
}
```

#### ã‚·ã‚¹ãƒ†ãƒ Bè¡¨ç¤º
```javascript
function displaySystemB(data) {
  // ãƒˆãƒ¬ãƒ³ãƒ‰ã€ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ã€ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ã€å‡ºæ¥é«˜
  // å¸‚å ´ãƒ¬ã‚¸ãƒ¼ãƒ åˆ¤å®š (ãƒˆãƒ¬ãƒ³ãƒ‰ç›¸å ´/ãƒ¬ãƒ³ã‚¸ç›¸å ´)
  // å‹•çš„ã‚¦ã‚§ã‚¤ãƒˆèª¿æ•´
  // GCã‚¹ã‚³ã‚¢ (è¤‡æ•°æ™‚é–“è»¸ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹)
}
```

#### ã‚·ã‚¹ãƒ†ãƒ Cè¡¨ç¤º (MLäºˆæ¸¬)
```javascript
function displaySystemC(data) {
  const current_price = data.current_price  // ç¾åœ¨ä¾¡æ ¼
  const future = data.future_predictions
  
  // æœªæ¥7æ—¥äºˆæ¸¬ãƒãƒ£ãƒ¼ãƒˆ
  renderFuturePredictionChart(future, current_price)
  
  // ãƒãƒƒã‚¯ãƒ•ã‚£ãƒƒãƒˆæ¤œè¨¼ãƒãƒ£ãƒ¼ãƒˆ (éå»30æ—¥)
  renderBackfitChart(data.training.backfit_predictions)
  
  // ç‰¹å¾´é‡é‡è¦åº¦ãƒãƒ£ãƒ¼ãƒˆ (Top 10)
  renderFeatureImportanceChart(data.training.feature_importances)
}
```

#### Chart.js ãƒãƒ£ãƒ¼ãƒˆæç”» (é‡è¦ãªä¿®æ­£)
```javascript
function renderFuturePredictionChart(future, current_price) {
  const ctx = document.getElementById('futurePredictionChart').getContext('2d')
  
  // ğŸ”¥ é‡è¦: æ—¢å­˜ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„ (å¤ã„ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚’é˜²ã)
  const existingChart = Chart.getChart('futurePredictionChart')
  if (existingChart) {
    existingChart.destroy()
  }
  
  // ç¾åœ¨ä¾¡æ ¼ã‚’èµ·ç‚¹ã¨ã—ã¦è¿½åŠ 
  const allDates = ['ä»Šæ—¥', ...future.dates]
  const allPredictions = [current_price, ...future.predictions]
  const allUpper = [current_price, ...future.upper_bound]
  const allLower = [current_price, ...future.lower_bound]
  
  console.log('[renderFuturePredictionChart] current_price:', current_price)
  
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: allDates,
      datasets: [
        {
          label: 'äºˆæ¸¬ä¾¡æ ¼',
          data: allPredictions,
          borderColor: 'rgb(34, 197, 94)',
          // ...
        },
        // ä¿¡é ¼åŒºé–“ï¼ˆä¸Šé™/ä¸‹é™ï¼‰
      ]
    }
  })
}
```

### âš ï¸ é‡è¦ãªæ³¨æ„ç‚¹

1. **Chart.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç ´æ£„**
   - åŒã˜ãƒšãƒ¼ã‚¸ã§è¤‡æ•°å›åˆ†æã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€`Chart.getChart().destroy()`ã‚’å¿…ãšå‘¼ã¶
   - ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨ã€å¤ã„ãƒãƒ£ãƒ¼ãƒˆãŒæ®‹ã‚Šã€èª¤ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

2. **current_priceã®æ­£ã—ã„å–å¾—**
   - `data.current_price` ã‹ã‚‰å–å¾—ï¼ˆ`future.predictions[0]`ã§ã¯ãªã„ï¼‰
   - APIå¿œç­”ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«å«ã¾ã‚Œã‚‹

---

## 3ï¸âƒ£ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒŠãƒ¼ (`technical-scanner.html`)

### ğŸ¯ ç›®çš„
è¤‡æ•°éŠ˜æŸ„ã‚’ä¸€æ‹¬ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã—ã€æ¡ä»¶ã«åˆè‡´ã™ã‚‹éŠ˜æŸ„ã‚’æŠ½å‡º

### ğŸ“Š å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¡ä»¶è¨­å®š
   - ã‚·ã‚¹ãƒ†ãƒ Aã‚¹ã‚³ã‚¢é–¾å€¤
   - ã‚·ã‚¹ãƒ†ãƒ Bã‚¹ã‚³ã‚¢é–¾å€¤
   - ã‚·ã‚°ãƒŠãƒ«ã‚¿ã‚¤ãƒ—
   â†“
2. éŠ˜æŸ„ãƒªã‚¹ãƒˆå…¥åŠ› (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)
   ä¾‹: AAPL,MSFT,GOOGL,META,TSLA
   â†“
3. ã€Œã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
4. å„éŠ˜æŸ„ã«å¯¾ã—ã¦APIå‘¼ã³å‡ºã—
   - /api/proxy/technical-analysis
   â†“
5. æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   â†“
6. ãƒãƒƒãƒã—ãŸéŠ˜æŸ„ã®ã¿è¡¨ç¤º
```

### ğŸ”‘ ä¸»è¦æ©Ÿèƒ½

#### ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¡ä»¶
```javascript
const filters = {
  systemAMin: 70,      // ã‚·ã‚¹ãƒ†ãƒ Aã‚¹ã‚³ã‚¢æœ€å°å€¤
  systemBMin: 60,      // ã‚·ã‚¹ãƒ†ãƒ Bã‚¹ã‚³ã‚¢æœ€å°å€¤
  signalType: 'è²·ã„'   // ã‚·ã‚°ãƒŠãƒ«ã‚¿ã‚¤ãƒ—
}

function matchesFilters(result) {
  return result.system_a_score >= filters.systemAMin &&
         result.system_b_score >= filters.systemBMin &&
         result.system_a_signal === filters.signalType
}
```

---

## ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIè©³ç´°

---

### ã‚·ã‚¹ãƒ†ãƒ A: ã‚·ãƒ³ãƒ—ãƒ«5æŒ‡æ¨™è©•ä¾¡ (`technical_scoring.py`)

#### ç›®çš„
é•·æœŸæŠ•è³‡å®¶å‘ã‘ã®åŸºæœ¬çš„ãªãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è©•ä¾¡

#### è©•ä¾¡æŒ‡æ¨™ (5ã¤)

1. **ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ (30%)**
   ```python
   # SMA 50æ—¥ > SMA 200æ—¥ â†’ ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ç™ºç”Ÿ
   if sma_50 > sma_200:
       score = 100
   elif sma_50 > sma_200 * 0.95:
       score = 80
   else:
       score = 0
   ```

2. **RSI (25%)**
   ```python
   # RSI 30ä»¥ä¸‹: è²·ã‚ã‚Œã™ã â†’ 100ç‚¹
   # RSI 70ä»¥ä¸Š: å£²ã‚‰ã‚Œã™ã â†’ 0ç‚¹
   if rsi <= 30:
       score = 100
   elif rsi >= 70:
       score = 0
   else:
       score = 50
   ```

3. **MACD (25%)**
   ```python
   # MACD > Signal â†’ ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ â†’ 100ç‚¹
   if macd > signal:
       score = 100
   else:
       score = 0
   ```

4. **ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ (15%)**
   ```python
   # ä¸‹é™ãƒãƒ³ãƒ‰ä»˜è¿‘: è²·ã„ã‚·ã‚°ãƒŠãƒ« â†’ 100ç‚¹
   # ä¸Šé™ãƒãƒ³ãƒ‰ä»˜è¿‘: å£²ã‚Šã‚·ã‚°ãƒŠãƒ« â†’ 0ç‚¹
   if price < lower_band * 1.02:
       score = 100
   elif price > upper_band * 0.98:
       score = 0
   else:
       score = 50
   ```

5. **å‡ºæ¥é«˜ (5%)**
   ```python
   # å¹³å‡å‡ºæ¥é«˜ã®1.5å€ä»¥ä¸Š: å¼·ã„é–¢å¿ƒ â†’ 100ç‚¹
   if volume > avg_volume * 1.5:
       score = 100
   elif volume > avg_volume:
       score = 70
   else:
       score = 30
   ```

#### ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
```python
total_score = (
    golden_cross_score * 0.30 +
    rsi_score * 0.25 +
    macd_score * 0.25 +
    bb_score * 0.15 +
    volume_score * 0.05
)
```

#### ã‚·ã‚°ãƒŠãƒ«åˆ¤å®š
```python
if total_score >= 80:
    signal = "å¼·ã„è²·ã„"
elif total_score >= 65:
    signal = "è²·ã„"
elif total_score >= 35:
    signal = "ä¸­ç«‹"
elif total_score >= 20:
    signal = "å£²ã‚Š"
else:
    signal = "å¼·ã„å£²ã‚Š"
```

---

### ã‚·ã‚¹ãƒ†ãƒ B: é«˜åº¦çŸ­æœŸãƒˆãƒ¬ãƒ¼ãƒ‰åˆ†æ (`technical_scoring_advanced.py`)

#### ç›®çš„
çŸ­æœŸãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼å‘ã‘ã®è¤‡é›‘ãªè¤‡åˆè©•ä¾¡ï¼ˆ1æ—¥ã€œ1ãƒ¶æœˆä¿æœ‰ï¼‰

#### è©•ä¾¡ã‚«ãƒ†ã‚´ãƒªãƒ¼ (4ã¤)

1. **ãƒˆãƒ¬ãƒ³ãƒ‰ (å‹•çš„ã‚¦ã‚§ã‚¤ãƒˆ 10-25%)**
   - ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹è¤‡æ•°æ™‚é–“è»¸ (5/10, 10/20, 20/50, 50/200)
   - ADX (ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦)
   - Aroon (ãƒˆãƒ¬ãƒ³ãƒ‰æ–¹å‘)

2. **ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ  (å‹•çš„ã‚¦ã‚§ã‚¤ãƒˆ 50-55%)**
   - RSI
   - Stochastic
   - CCI
   - ROC

3. **ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ (å‹•çš„ã‚¦ã‚§ã‚¤ãƒˆ 10-30%)**
   - ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰
   - ATR
   - ä¾¡æ ¼å¤‰å‹•ç‡

4. **å‡ºæ¥é«˜ (å›ºå®š 10%)**
   - å‡ºæ¥é«˜ãƒˆãƒ¬ãƒ³ãƒ‰
   - OBV (On-Balance Volume)

#### å¸‚å ´ãƒ¬ã‚¸ãƒ¼ãƒ åˆ¤å®š
```python
def detect_market_regime(adx: float) -> MarketRegime:
    if adx > 40:
        return MarketRegime.STRONG_TREND  # å¼·ã„ãƒˆãƒ¬ãƒ³ãƒ‰ç›¸å ´
    elif adx > 25:
        return MarketRegime.TREND         # ãƒˆãƒ¬ãƒ³ãƒ‰ç›¸å ´
    else:
        return MarketRegime.RANGE         # ãƒ¬ãƒ³ã‚¸ç›¸å ´
```

#### å‹•çš„ã‚¦ã‚§ã‚¤ãƒˆèª¿æ•´
```python
def get_dynamic_weights(market_regime: MarketRegime):
    if market_regime == MarketRegime.STRONG_TREND:
        return {
            'trend': 0.25,       # ãƒˆãƒ¬ãƒ³ãƒ‰ç›¸å ´ã§ã¯ãƒˆãƒ¬ãƒ³ãƒ‰æŒ‡æ¨™é‡è¦–
            'momentum': 0.55,
            'volatility': 0.10,
            'volume': 0.10
        }
    elif market_regime == MarketRegime.RANGE:
        return {
            'trend': 0.10,       # ãƒ¬ãƒ³ã‚¸ç›¸å ´ã§ã¯ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£é‡è¦–
            'momentum': 0.50,
            'volatility': 0.30,
            'volume': 0.10
        }
```

#### ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ã‚¹ã‚³ã‚¢ (GCæŒ‡æ¨™)
```python
# è¤‡æ•°æ™‚é–“è»¸ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ã‚’è©•ä¾¡
crossover_pairs = [
    (5, 10, 40.0),    # è¶…çŸ­æœŸ (æœ€é‡è¦40%)
    (10, 20, 35.0),   # çŸ­æœŸ (é‡è¦35%)
    (20, 50, 20.0),   # ä¸­çŸ­æœŸ (20%)
    (50, 200, 5.0)    # é•·æœŸ (5%)
]

gc_score = sum(
    score * weight 
    for (short, long, weight), score in zip(crossover_pairs, scores)
)
```

---

### ã‚·ã‚¹ãƒ†ãƒ C: MLäºˆæ¸¬ (LightGBM) (`technical_ml_model.py`)

#### ç›®çš„
æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æœªæ¥7æ—¥é–“ã®æ ªä¾¡äºˆæ¸¬

#### ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° (107ç‰¹å¾´é‡)

**21ç¨®é¡ã®ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‹ã‚‰107ç‰¹å¾´é‡ã‚’ç”Ÿæˆ:**

1. **åŸºæœ¬ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ (5)**
   - open, high, low, close, volume

2. **ç§»å‹•å¹³å‡ (10)**
   - SMA: 5, 10, 20, 50, 200æ—¥
   - EMA: 5, 10, 20, 50, 200æ—¥

3. **ç§»å‹•å¹³å‡æ¯”ç‡ (3)**
   - sma5_to_sma20
   - sma20_to_sma50
   - sma50_to_sma200

4. **ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ æŒ‡æ¨™ (15)**
   - RSI (14æ—¥)
   - Stochastic (K, D)
   - CCI
   - ROC (1æ—¥, 5æ—¥, 10æ—¥)
   - Williams %R
   - MFI (Money Flow Index)

5. **ãƒˆãƒ¬ãƒ³ãƒ‰æŒ‡æ¨™ (8)**
   - MACD (MACD, Signal, Histogram)
   - ADX, +DI, -DI
   - Aroon (Up, Down)

6. **ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£æŒ‡æ¨™ (6)**
   - ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ (Upper, Middle, Lower)
   - ATR
   - ä¾¡æ ¼å¤‰å‹•ç‡

7. **å‡ºæ¥é«˜æŒ‡æ¨™ (3)**
   - OBV
   - å‡ºæ¥é«˜ç§»å‹•å¹³å‡
   - å‡ºæ¥é«˜æ¯”ç‡

8. **æ´¾ç”Ÿç‰¹å¾´é‡ (57)**
   - ä¾¡æ ¼å¤‰åŒ–ç‡ (1æ—¥, 5æ—¥, 10æ—¥, 20æ—¥)
   - ãƒ©ã‚°ç‰¹å¾´é‡ (éå»1-5æ—¥ã®ä¾¡æ ¼)
   - ãƒ­ãƒ¼ãƒªãƒ³ã‚°çµ±è¨ˆé‡ (mean, std, min, max)
   - ç›¸äº’ä½œç”¨ç‰¹å¾´é‡ (RSI Ã— MACDç­‰)

#### LightGBMãƒ¢ãƒ‡ãƒ«å­¦ç¿’

```python
def train(self, features: pd.DataFrame, target: pd.Series, enable_backfit: bool):
    # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ç¿Œæ—¥ã®çµ‚å€¤
    target = prices['close'].shift(-1)
    
    # ãƒ‡ãƒ¼ã‚¿åˆ†å‰²
    if enable_backfit:
        # ãƒãƒƒã‚¯ãƒ•ã‚£ãƒƒãƒˆæ¤œè¨¼: æœ€æ–°30æ—¥ã‚’ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        X_train = features[:-30]
        X_val = features[-30:]
    else:
        # é€šå¸¸: ãƒ©ãƒ³ãƒ€ãƒ 80:20åˆ†å‰²
        X_train, X_val = train_test_split(features, target, test_size=0.2)
    
    # æ¨™æº–åŒ–
    self.scaler = StandardScaler()
    X_train_scaled = self.scaler.fit_transform(X_train)
    X_val_scaled = self.scaler.transform(X_val)
    
    # LightGBMå­¦ç¿’
    self.model = lgb.LGBMRegressor(
        objective='regression',
        n_estimators=200,
        learning_rate=0.05,
        max_depth=7,
        num_leaves=31,
        min_child_samples=20
    )
    self.model.fit(X_train_scaled, y_train)
```

#### æœªæ¥äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯ (Direct LGBM + Decay)

**ğŸ”¥ é‡è¦ãªä¿®æ­£ç®‡æ‰€:**

```python
def predict_future_direct(self, features: pd.DataFrame, days: int = 7):
    """
    ç›´æ¥äºˆæ¸¬æ–¹å¼ï¼šLGBMãƒ¢ãƒ‡ãƒ«ã§1æ—¥å¾Œã‚’ç›´æ¥äºˆæ¸¬ + æ¸›è¡°ãƒˆãƒ¬ãƒ³ãƒ‰
    
    Day 1: LGBM(æœ€æ–°ç‰¹å¾´é‡) â†’ å®Œå…¨ãªéç·šå½¢äºˆæ¸¬ï¼ˆçµ¶å¯¾ä¾¡æ ¼ï¼‰
    Day 2-7: current_price + (Day1äºˆæ¸¬ - current_price) Ã— æ¸›è¡°ä¿‚æ•°(0.95^i)
            â†’ äºˆæ¸¬å¤‰åŒ–é‡ã‚’æ¸›è¡°ã•ã›ã¦ç¾åœ¨ä¾¡æ ¼ã«åŠ ç®—
    """
    # ç¾åœ¨ã®ä¾¡æ ¼ï¼ˆæœ€æ–°ã®çµ‚å€¤ï¼‰
    current_price = features['close'].iloc[-1]
    
    # LGBMã§1æ—¥å¾Œã®çµ¶å¯¾ä¾¡æ ¼ã‚’äºˆæ¸¬
    # æ³¨: ãƒ¢ãƒ‡ãƒ«ã¯ prices['close'].shift(-1) ã§å­¦ç¿’ï¼ˆç¿Œæ—¥ã®çµ¶å¯¾ä¾¡æ ¼ï¼‰
    day1_prediction = self.model.predict(latest_scaled)[0]
    
    # Day 1ã®äºˆæ¸¬å¤‰åŒ–é‡ã‚’è¨ˆç®—
    predicted_change = day1_prediction - current_price
    
    future_prices = []
    for i in range(days):
        if i == 0:
            # Day 1: LGBMã®ç›´æ¥äºˆæ¸¬ï¼ˆçµ¶å¯¾ä¾¡æ ¼ï¼‰
            next_price = day1_prediction
        else:
            # Day 2ä»¥é™: ç¾åœ¨ä¾¡æ ¼ + äºˆæ¸¬å¤‰åŒ–é‡ Ã— æ¸›è¡°ä¿‚æ•°
            # æ¸›è¡°ä¿‚æ•° = 0.95^i ã§æ—¥æ•°ãŒå¢—ãˆã‚‹ã»ã©å¤‰åŒ–ãŒå°ã•ããªã‚‹
            decay_factor = 0.95 ** i
            next_price = current_price + (predicted_change * decay_factor)
        
        future_prices.append(float(next_price))
    
    return {
        'current_price': float(current_price),  # ç¾åœ¨ä¾¡æ ¼ã‚’è¿½åŠ 
        'dates': future_dates,
        'predictions': future_prices,
        'lower_bound': lower_bound,
        'upper_bound': upper_bound,
        'confidence_std': float(prediction_uncertainty),
        'method': 'direct_lgbm_with_decay'
    }
```

**ãªãœã“ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒé‡è¦ã‹:**

- **ä¿®æ­£å‰ã®å•é¡Œ**: Day 2ä»¥é™ãŒç´¯ç©è¨ˆç®—ã§ç•°å¸¸ãªå€¤ï¼ˆãƒã‚¤ãƒŠã‚¹ä¾¡æ ¼ç­‰ï¼‰ã«ãªã£ã¦ã„ãŸ
- **ä¿®æ­£å¾Œ**: ç¾åœ¨ä¾¡æ ¼ã‚’åŸºæº–ã«ã€äºˆæ¸¬å¤‰åŒ–é‡ã‚’æ¸›è¡°ã•ã›ã¦åŠ ç®—
- **çµæœ**: åˆç†çš„ãªäºˆæ¸¬ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆå¾ã€…ã«ç¾åœ¨ä¾¡æ ¼ã«æˆ»ã‚‹ï¼‰

#### ãƒãƒƒã‚¯ãƒ•ã‚£ãƒƒãƒˆæ¤œè¨¼

```python
def generate_backfit_predictions(self, X_val_scaled, y_val_actual):
    """
    éå»30æ—¥ã®å®Ÿéš›ã®ä¾¡æ ¼ã¨äºˆæ¸¬ã‚’æ¯”è¼ƒ
    ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚±ãƒ¼ã‚¸ãªã—ï¼ˆDay Nã®ç‰¹å¾´é‡ã§Day N+1ã‚’äºˆæ¸¬ï¼‰
    """
    predictions = self.model.predict(X_val_scaled)
    
    # æ–¹å‘æ€§ç²¾åº¦: ä¸Šæ˜‡/ä¸‹é™ã®äºˆæ¸¬ãŒå½“ãŸã£ãŸå‰²åˆ
    direction_accuracy = calculate_direction_accuracy(y_val_actual, predictions)
    
    return {
        'dates': dates,
        'predictions': predictions.tolist(),
        'actual_prices': y_val_actual.tolist(),
        'rmse': float(rmse),
        'mae': float(mae),
        'direction_accuracy': float(direction_accuracy)
    }
```

---

## ğŸ—„ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ  (`cache_manager.py`)

### ç›®çš„
Alpha Vantage APIå‘¼ã³å‡ºã—ã‚’å‰Šæ¸›ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ã‚’å‘ä¸Š

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»•æ§˜

```python
class CacheManager:
    CACHE_EXPIRY_HOURS = 1  # 1æ™‚é–“TTL
    CACHE_DIR = '/tmp/alphavantage_cache'
    
    def get(self, symbol: str, endpoint: str, params: Dict) -> Optional[Dict]:
        cache_key = self._generate_cache_key(symbol, endpoint, params)
        cache_file = os.path.join(self.CACHE_DIR, f"{cache_key}.json")
        
        if os.path.exists(cache_file):
            # ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚åˆ»ã‚’ãƒã‚§ãƒƒã‚¯
            file_time = datetime.fromtimestamp(os.path.getmtime(cache_file))
            age_hours = (datetime.now() - file_time).total_seconds() / 3600
            
            if age_hours < self.CACHE_EXPIRY_HOURS:
                logger.info(f"Cache hit for {symbol}:{endpoint}")
                with open(cache_file, 'r') as f:
                    return json.load(f)
        
        return None
    
    def set(self, symbol: str, endpoint: str, data: Dict, params: Dict):
        # ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã„
        if self._is_error_response(data):
            logger.warning(f"Skipping cache - error response")
            return
        
        cache_key = self._generate_cache_key(symbol, endpoint, params)
        cache_file = os.path.join(self.CACHE_DIR, f"{cache_key}.json")
        
        with open(cache_file, 'w') as f:
            json.dump(data, f)
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ

```python
def _generate_cache_key(self, symbol: str, endpoint: str, params: Dict) -> str:
    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚ã¦ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚­ãƒ¼ã‚’ç”Ÿæˆ
    params_str = json.dumps(params, sort_keys=True)
    key_str = f"{symbol}_{endpoint}_{params_str}"
    return hashlib.md5(key_str.encode()).hexdigest()
```

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œå‡º

```python
def _is_error_response(self, data: Dict) -> bool:
    """å…¨ã¦ã®å€¤ãŒNoneã¾ãŸã¯ç©ºã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹"""
    if not isinstance(data, dict) or not data:
        return True
    
    all_null = all(
        v is None or (isinstance(v, dict) and not v) 
        for v in data.values()
    )
    return all_null
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ

```python
def get_cache_stats(self) -> Dict:
    total_files = 0
    expired_files = 0
    total_size = 0
    
    for file in os.listdir(self.CACHE_DIR):
        file_path = os.path.join(self.CACHE_DIR, file)
        total_files += 1
        total_size += os.path.getsize(file_path)
        
        file_time = datetime.fromtimestamp(os.path.getmtime(file_path))
        age_hours = (datetime.now() - file_time).total_seconds() / 3600
        
        if age_hours >= self.CACHE_EXPIRY_HOURS:
            expired_files += 1
    
    return {
        'total_files': total_files,
        'expired_files': expired_files,
        'active_files': total_files - expired_files,
        'total_size_mb': round(total_size / 1024 / 1024, 1)
    }
```

### ãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (ãƒ¡ãƒ¢ãƒªå†…)

```python
# technical_ml_model.py
MODEL_CACHE = {}  # ãƒ¡ãƒ¢ãƒªå†…ã‚­ãƒ£ãƒƒã‚·ãƒ¥
MAX_CACHE_SIZE = 100

def get_or_train_model(indicators, symbol, enable_backfit, force_retrain):
    cache_key = hashlib.md5(f"{symbol}_{enable_backfit}".encode()).hexdigest()
    
    if not force_retrain and cache_key in MODEL_CACHE:
        cached_item = MODEL_CACHE[cache_key]
        
        # 1æ™‚é–“ä»¥å†…ãªã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨
        if (datetime.now() - cached_item['timestamp']).seconds < 3600:
            logger.info(f"Using cached model for {symbol}")
            return cached_item['model'], cached_item['result']
    
    # æ–°è¦å­¦ç¿’
    model, result = train_technical_model(indicators, symbol, enable_backfit)
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    MODEL_CACHE[cache_key] = {
        'model': model,
        'result': result,
        'timestamp': datetime.now()
    }
    
    return model, result
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»èµ·å‹•æ‰‹é †

### å‰ææ¡ä»¶
- Python 3.12
- Node.js 20+
- PM2 (ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†)

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (ml-api) èµ·å‹•

```bash
cd /home/user/ml-api

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# PM2ã§èµ·å‹•
pm2 start ecosystem.config.cjs

# ãƒ­ã‚°ç¢ºèª
pm2 logs ml-api --nostream
```

**ecosystem.config.cjs:**
```javascript
module.exports = {
  apps: [{
    name: 'ml-api',
    script: 'uvicorn',
    args: 'main:app --host 0.0.0.0 --port 8001',
    env: {
      PYTHONUNBUFFERED: '1',
      PORT: 8001
    },
    watch: false,
    instances: 1,
    exec_mode: 'fork'
  }]
}
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (webapp) èµ·å‹•

```bash
cd /home/user/webapp

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# PM2ã§èµ·å‹•
pm2 start ecosystem.config.cjs

# ãƒ­ã‚°ç¢ºèª
pm2 logs static-server --nostream
```

**ecosystem.config.cjs:**
```javascript
module.exports = {
  apps: [{
    name: 'static-server',
    script: './simple-server.cjs',
    env: {
      NODE_ENV: 'development',
      PORT: 3000
    },
    watch: false,
    instances: 1,
    exec_mode: 'fork'
  }]
}
```

**simple-server.cjs (è»½é‡Node.jsã‚µãƒ¼ãƒãƒ¼):**
```javascript
const http = require('http');
const fs = require('fs');
const path = require('path');

const PORT = 3000;
const STATIC_DIR = path.join(__dirname, 'dist/static');

const MIME_TYPES = {
  '.html': 'text/html',
  '.js': 'text/javascript',
  '.css': 'text/css',
  '.json': 'application/json',
  '.png': 'image/png',
  '.jpg': 'image/jpg',
  '.gif': 'image/gif',
  '.svg': 'image/svg+xml',
  '.ico': 'image/x-icon'
};

const server = http.createServer((req, res) => {
  console.log(`${req.method} ${req.url}`);
  
  // ãƒ«ãƒ¼ãƒˆã¯ NASDAQ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (req.url === '/') {
    res.writeHead(302, { 'Location': '/static/nasdaq-ranking.html' });
    res.end();
    return;
  }
  
  // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«æä¾›
  if (req.url.startsWith('/static/')) {
    const filePath = path.join(STATIC_DIR, req.url.replace('/static/', ''));
    
    fs.readFile(filePath, (err, data) => {
      if (err) {
        res.writeHead(404);
        res.end('File not found');
        return;
      }
      
      const ext = path.extname(filePath);
      const contentType = MIME_TYPES[ext] || 'text/plain';
      
      res.writeHead(200, { 'Content-Type': contentType });
      res.end(data);
    });
    return;
  }
  
  // ML API ãƒ—ãƒ­ã‚­ã‚·
  if (req.url.startsWith('/api/')) {
    const options = {
      hostname: 'localhost',
      port: 8001,
      path: req.url,
      method: req.method,
      headers: req.headers
    };
    
    const proxyReq = http.request(options, (proxyRes) => {
      res.writeHead(proxyRes.statusCode, proxyRes.headers);
      proxyRes.pipe(res);
    });
    
    req.pipe(proxyReq);
    return;
  }
  
  res.writeHead(404);
  res.end('Not Found');
});

server.listen(PORT, '0.0.0.0', () => {
  console.log(`Server running at http://0.0.0.0:${PORT}/`);
});
```

### 3. å‹•ä½œç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIç¢ºèª
curl http://localhost:8001/health

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç¢ºèª
curl http://localhost:3000/static/nasdaq-ranking.html

# MLäºˆæ¸¬APIç¢ºèª
curl -X POST http://localhost:8001/api/technical-ml-predict \
  -H "Content-Type: application/json" \
  -d '{"symbol":"AAPL","alpha_vantage_api_key":"YOUR_KEY","enable_backfit":false}'
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—)

- **ã‚·ã‚¹ãƒ†ãƒ A/Båˆ†æ**: 3-5ç§’
- **ã‚·ã‚¹ãƒ†ãƒ C (MLäºˆæ¸¬)**: 7-10ç§’
- **NASDAQ-100å…¨éŠ˜æŸ„**: 8-12åˆ†

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹)

- **ã‚·ã‚¹ãƒ†ãƒ A/Båˆ†æ**: 0.1-0.3ç§’ (97%çŸ­ç¸®)
- **ã‚·ã‚¹ãƒ†ãƒ C (MLäºˆæ¸¬)**: 0.05-0.1ç§’ (99%çŸ­ç¸®)
- **NASDAQ-100å…¨éŠ˜æŸ„**: 15-30ç§’ (95%çŸ­ç¸®)

### Alpha Vantage APIå‘¼ã³å‡ºã—

- **Premiumåˆ¶é™**: 75 calls/minute
- **1éŠ˜æŸ„ã‚ãŸã‚Š**: 21 APIå‘¼ã³å‡ºã— (ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™)
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœ**: 1æ™‚é–“ä»¥å†…ã®å†åˆ†æã¯0å‘¼ã³å‡ºã—

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Chart.jså¤ã„ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºå•é¡Œ

**ç—‡çŠ¶**: åŒã˜ãƒšãƒ¼ã‚¸ã§è¤‡æ•°å›åˆ†æã™ã‚‹ã¨ã€å¤ã„ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **: Chart.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç ´æ£„ã•ã‚Œãšã€æ–°ã—ã„ãƒãƒ£ãƒ¼ãƒˆãŒé‡ã­ã¦æç”»ã•ã‚Œã‚‹

**è§£æ±ºæ–¹æ³•**:
```javascript
// ãƒãƒ£ãƒ¼ãƒˆæç”»å‰ã«å¿…ãšæ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç ´æ£„
const existingChart = Chart.getChart('futurePredictionChart')
if (existingChart) {
  existingChart.destroy()
}
```

### ã‚·ã‚¹ãƒ†ãƒ Cäºˆæ¸¬å€¤ãŒç•°å¸¸

**ç—‡çŠ¶**: Day 2ä»¥é™ã®äºˆæ¸¬ãŒãƒã‚¤ãƒŠã‚¹ä¾¡æ ¼ã‚„ç•°å¸¸ãªå€¤ã«ãªã‚‹

**åŸå› **: `predict_future_direct`ã®Day 2ä»¥é™è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ãŒèª¤ã£ã¦ã„ãŸ

**è§£æ±ºæ–¹æ³•**:
```python
# ä¿®æ­£å‰ï¼ˆèª¤ã‚Šï¼‰
next_price = future_prices[-1] + price_change  # ç´¯ç©ã§ç•°å¸¸å€¤

# ä¿®æ­£å¾Œï¼ˆæ­£ã—ã„ï¼‰
next_price = current_price + (predicted_change * decay_factor)
```

### current_priceãŒnull

**ç—‡çŠ¶**: APIå¿œç­”ã§`current_price`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒnull

**åŸå› **: 
1. `predict_future_direct`ã®è¿”ã‚Šå€¤ã«å«ã¾ã‚Œã¦ã„ãªã„
2. `TechnicalMLResponse`ã‚¹ã‚­ãƒ¼ãƒã«å®šç¾©ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
1. `predict_future_direct`ã«`'current_price': float(current_price)`ã‚’è¿½åŠ 
2. `TechnicalMLResponse`ã«`current_price: Optional[float] = None`ã‚’è¿½åŠ 

---

## ğŸ“ ä»Šå¾Œã®æ”¹å–„æ¡ˆ

### æ©Ÿèƒ½è¿½åŠ 

1. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**
   - WebSocketã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ ªä¾¡è¡¨ç¤º
   
2. **ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½**
   - ç‰¹å®šæ¡ä»¶ã§ãƒ¡ãƒ¼ãƒ«/Slacké€šçŸ¥

3. **ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†**
   - è¤‡æ•°éŠ˜æŸ„ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªè¿½è·¡

4. **ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**
   - éå»ãƒ‡ãƒ¼ã‚¿ã§ãƒˆãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥æ¤œè¨¼

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

1. **Rediså°å…¥**
   - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã‹ã‚‰Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¸ç§»è¡Œ

2. **éåŒæœŸå‡¦ç†**
   - asyncioã§ä¸¦åˆ—å‡¦ç†é«˜é€ŸåŒ–

3. **CDNé…ä¿¡**
   - é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’CDNçµŒç”±ã§é…ä¿¡

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### API Keyç®¡ç†

- **Alpha Vantage API Key**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å…¥åŠ›ï¼ˆæœ¬ç•ªã§ã¯ç’°å¢ƒå¤‰æ•°æ¨å¥¨ï¼‰
- **æ©Ÿå¯†æƒ…å ±**: `.gitignore`ã§é™¤å¤–

### CORSè¨­å®š

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # æœ¬ç•ªã§ã¯ç‰¹å®šãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆ¶é™
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- **Alpha Vantage API**: https://www.alphavantage.co/documentation/
- **LightGBM**: https://lightgbm.readthedocs.io/
- **Chart.js**: https://www.chartjs.org/
- **FastAPI**: https://fastapi.tiangolo.com/
- **DataTables**: https://datatables.net/

---

**ä½œæˆæ—¥**: 2025-11-04  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Working State Backup  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å…¨æ©Ÿèƒ½å‹•ä½œç¢ºèªæ¸ˆã¿
